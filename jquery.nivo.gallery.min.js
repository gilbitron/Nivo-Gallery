/*
 * jQuery Nivo Gallery v0.7.1
 * http://dev7studios.com
 *
 * Copyright 2011, Gilbert Pellegrom
 * Free to use and abuse under the MIT license.
 * http://www.opensource.org/licenses/mit-license.php
 * 
 * October 2011
 */
 
(function(a){a.nivoGallery=function(h,m){var g={pauseTime:3000,animSpeed:300,effect:"fade",startPaused:false,directionNav:true,progressBar:true,galleryLoaded:function(){},beforeChange:function(o,n,p){},afterChange:function(o,n,p){},galleryEnd:function(){}};var d={slides:[],currentSlide:0,totalSlides:0,animating:false,paused:false,timer:null,progressTimer:null};var i=this;i.settings={};var l=a(h),h=h;i.init=function(){i.settings=a.extend({},g,m);e()};var e=function(){d.slides=l.find("ul li").remove();d.totalSlides=d.slides.length;l.find("ul").addClass("nivoGallery-slides");if(i.settings.progressBar){l.append('<div class="nivoGallery-progress"></div>')}if(i.settings.directionNav){l.append('<div class="nivoGallery-directionNav"><a class="nivoGallery-prev">Prev</a> <a class="nivoGallery-next">Next</a></div>')}l.append('<div class="nivoGallery-bar"><a class="nivoGallery-play playing" title="Play / Pause"></a><div class="nivoGallery-count">'+c()+'</div><div class="nivoGallery-caption">'+j()+'</div><a class="nivoGallery-fullscreen" title="Toggle Fullscreen"></a></div>').fadeIn(200);f(d.currentSlide)};var c=function(){return(d.currentSlide+1)+" / "+d.totalSlides};var j=function(){var p=a(d.slides[d.currentSlide]).attr("data-title");var o=a(d.slides[d.currentSlide]).attr("data-caption");var n="";if(p){n+='<span class="nivoGallery-captionTitle">'+p+"</span>"}if(o){n+=o}return n};var b=function(){clearTimeout(d.timer);if(i.settings.progressBar){clearInterval(d.progressTimer);l.find(".nivoGallery-progress").width("0%")}if(!d.paused){d.timer=setTimeout(function(){l.trigger("nextslide")},i.settings.pauseTime);if(i.settings.progressBar){var n=new Date();d.progressTimer=setInterval(function(){var p=new Date()-n;var o=(p/i.settings.pauseTime)*100;l.find(".nivoGallery-progress").width(o+"%");if(o>100){clearInterval(d.progressTimer);l.find(".nivoGallery-progress").width("0%")}},10)}}};var f=function(n,p){if(a(d.slides[n]).data("loaded")){if(typeof p=="function"){p.call(this)}return}if(a(d.slides[n]).find("img").length>0&&(a(d.slides[n]).attr("data-type")!="html"&&a(d.slides[n]).attr("data-type")!="video")){l.removeClass("loaded");var o=new Image();a(o).load(function(){l.find(".nivoGallery-slides").append(d.slides[n]);a(d.slides[n]).fadeIn(i.settings.animSpeed);if(n==0){l.trigger("galleryloaded")}l.addClass("loaded");a(d.slides[n]).data("loaded",true);a(d.slides[n]).addClass("slide-"+(n+1));if(typeof p=="function"){p.call(this)}}).attr("src",a(d.slides[n]).find("img:first").attr("src")).attr("alt",(a(d.slides[n]).find("img:first").attr("alt")!=undefined)?a(d.slides[n]).find("img:first").attr("alt"):"").attr("title",(a(d.slides[n]).find("img:first").attr("title")!=undefined)?a(d.slides[n]).find("img:first").attr("title"):"")}else{l.find(".nivoGallery-slides").append(d.slides[n]);if(n==0){l.trigger("galleryloaded")}l.addClass("loaded");a(d.slides[n]).data("loaded",true);a(d.slides[n]).addClass("slide-"+(n+1));if(a(d.slides[n]).attr("data-type")=="html"){a(d.slides[n]).wrapInner('<div class="nivoGallery-htmlwrap"></div>')}if(a(d.slides[n]).attr("data-type")=="video"){a(d.slides[n]).wrapInner('<div class="nivoGallery-videowrap"></div>')}if(typeof p=="function"){p.call(this)}}};var k=function(o){if(d.animating){return}i.settings.beforeChange.call(this,d.currentSlide,a(d.slides[d.currentSlide]),d.paused);if(i.settings.effect=="fade"){var n=false;d.animating=true;a(d.slides[d.currentSlide]).fadeOut(i.settings.animSpeed,function(){if(o=="prev"){d.currentSlide--;if(d.currentSlide<0){d.currentSlide=d.totalSlides-1;n=true}}else{d.currentSlide++;if(d.currentSlide>=d.totalSlides){d.currentSlide=0;n=true}}f(d.currentSlide,function(){l.find(".nivoGallery-count").text(c());l.find(".nivoGallery-caption").html(j());a(d.slides[d.currentSlide]).fadeIn(i.settings.animSpeed,function(){d.animating=false;b();i.settings.afterChange.call(this,d.currentSlide,a(d.slides[d.currentSlide]),d.paused);if(n){i.settings.galleryEnd.call(this)}})})})}};i.play=function(){l.find(".nivoGallery-play").addClass("playing");d.paused=false;b()};i.pause=function(){l.find(".nivoGallery-play").removeClass("playing");d.paused=true;b()};i.nextSlide=function(){i.pause();k("next")};i.prevSlide=function(){i.pause();k("prev")};i.goTo=function(n){if(n==d.currentSlide||d.animating){return}a(d.slides[d.currentSlide]).fadeOut(i.settings.animSpeed);d.currentSlide=(n-1);if(d.currentSlide<0){d.currentSlide=d.totalSlides-1}if(d.currentSlide>d.totalSlides-1){d.currentSlide=d.totalSlides-2}i.pause();k("next")};l.bind("galleryloaded",function(){a(d.slides[d.currentSlide]).fadeIn(200);if(i.settings.startPaused){i.pause()}else{b()}i.settings.galleryLoaded.call(this)});l.find(".nivoGallery-play").live("click",function(){a(this).toggleClass("playing");d.paused=!d.paused;b();return false});l.bind("nextslide",function(){k("next")});l.find(".nivoGallery-prev").live("click",function(){i.prevSlide()});l.find(".nivoGallery-next").live("click",function(){i.nextSlide()});l.find(".nivoGallery-fullscreen").live("click",function(){l.toggleClass("fullscreen")});a(document).keyup(function(n){if(n.keyCode==27){l.removeClass("fullscreen")}});i.init()};a.fn.nivoGallery=function(b){return this.each(function(){if(undefined==a(this).data("nivoGallery")){var c=new a.nivoGallery(this,b);a(this).data("nivoGallery",c)}})}})(jQuery);